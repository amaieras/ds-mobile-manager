<p-growl [(value)]="msgs"></p-growl>
<div class="col-md-offset-1 col-md-9">
  <h1>Client - GSM</h1>
  <form [formGroup]="clientGSMForm" novalidate #formGSM="ngForm">
    <div class="form-group">
      <label for="lastname">Nume</label>
      <div class="ui-inputgroup">
        <span class="ui-inputgroup-addon"><i class="fa fa-user"></i></span>
        <input
          placeholder="Nume"
          id="lastname"
          #searchBox
          class="form-control"
          (keyup)="search(searchBox.value)"
          formControlName="lastname"
          required
        />
      </div>
      <ul class="search-result">
        <li *ngFor="let clientGSM of clientGSMSearch">
          <a (click)="fillInfo(clientGSM)">
            {{ clientGSM.name | titleCase }} - {{ clientGSM.phone }} -
            {{ clientGSM.firm }}
          </a>
        </li>
      </ul>
      <div
        *ngIf="lastname.invalid && (lastname.dirty || lastname.touched)"
        class="alert alert-danger"
      >
        <div *ngIf="lastname.errors.required">
          Numele nu este completat.
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="firm">Firma</label>
      <input
        placeholder="Firma"
        id="firm"
        class="form-control"
        formControlName="firm"
      />
    </div>
    <div class="form-group">
      <label for="phone">Numar de telefon</label>
      <input
        placeholder="Numar de telefon"
        id="phone"
        class="form-control"
        formControlName="phone"
      />
      <div
        *ngIf="phone.invalid && (phone.dirty || phone.touched)"
        class="alert alert-danger"
      >
        <div *ngIf="phone.errors.required">
          Numarul de telefon nu este completat.
        </div>
      </div>
    </div>
    <div formArrayName="phoneList" class="well well-lg">
      <div
        *ngFor="
          let phone of clientGSMForm.controls['phoneList']['controls'];
          let i = index
        "
      >
        <div class="panel-heading">
          <h3>Lista numarul: #{{ i + 1 }}</h3>
          <span
            class="glyphicon glyphicon-remove pull-right"
            style="cursor: pointer"
            *ngIf="clientGSMForm.controls.phoneList.controls.length > 1"
            (click)="removeFromPhoneList(i)"
          ></span>
        </div>
        <div class="panel-body" [formGroupName]="i">
          <phone-gsm-list
            [group]="clientGSMForm.controls['phoneList']['controls'][i]"
          ></phone-gsm-list>
        </div>
        <br />
      </div>
      <button type="button" class="btn btn-primary" (click)="addInPhoneList()">
        Adauga alt telefon +
      </button>
    </div>
    <div class="form-group">
      <label for="priceOffer">Avans</label>
      <div class="ui-inputgroup">
        <span class="ui-inputgroup-addon" style="width: 50px;">RON</span>
        <input
          placeholder="Avans"
          id="paymentMethod"
          class="form-control"
          formControlName="advancePayment"
          style="width: auto !important;"
        />
      </div>
    </div>
    <div class="form-group">
      <label for="priceOffer">Total de plata</label>
      <div class="ui-inputgroup">
        <span class="ui-inputgroup-addon" style="width: 50px;">RON</span>
        <input
          placeholder="Total de plata"
          id="priceOffer"
          class="form-control"
          [(ngModel)]="totalPrice"
          formControlName="priceOffer"
          style="width: auto !important;"
        />
      </div>
    </div>
    <div class="form-group">
      <label for="totalQuantity">Total piese</label>
      <div class="ui-inputgroup">
        <span class="ui-inputgroup-addon" style="width: 50px;"
          ><i class="fa fa-mobile" aria-hidden="true"></i
        ></span>
        <input
          placeholder="Total cantitate"
          id="totalQuantity"
          class="form-control"
          [(ngModel)]="totalNoQuantity"
          formControlName="totalQuantity"
          style="width: auto !important;"
        />
      </div>
    </div>
    <div class="form-group">
      <button
        type="button"
        (click)="calculateTotalQuantity()"
        class="btn btn-success"
      >
        Calculeaza pretul si cantitatea totala
      </button>
    </div>
    <div class="form-group">
      <label for="city">Orasul</label>
      <input
        placeholder="Orasul"
        id="city"
        class="form-control"
        formControlName="city"
        required
      />
      <div
        *ngIf="city.invalid && (city.dirty || city.touched)"
        class="alert alert-danger"
      >
        <div *ngIf="city.errors.required">
          Orasul nu este completat.
        </div>
      </div>
    </div>

    <button
      type="submit"
      class="btn btn-default btn-bottom"
      [disabled]="clientGSMForm.invalid"
      (click)="onSubmit($event)"
    >
      Salveaza/Printeaza
    </button>
    <app-print-gsm-receipt></app-print-gsm-receipt>
  </form>
</div>
